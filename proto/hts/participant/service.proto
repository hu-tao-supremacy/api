syntax = "proto3";

package hts.participant;

option java_multiple_files = true;
option java_package = "app.onepass.apis";
option java_outer_classname = "ParticipantProto";
option go_package = "onepass.app/facility/hts/participant";

import "hts/common/common.proto";

import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";

message GenerateQRRequest {
    hts.common.UserEvent user_event = 1;
}

message GetEventRequest {
    int64 event_id = 1;
}

message StringInputRequest {
    string text = 1;
}

message UserWithEventRequest {
    hts.common.User user = 1;
    hts.common.Event event = 2;
}

message CreateFeedbackRequest {
    hts.common.User user = 1;
    hts.common.EventFeedback feedback = 2;
}

message GenerateQRResponse {
    string data = 1;
}

message GetFeedbacksFromEventResponse {
    repeated hts.common.EventFeedback event_feedback = 1;
}

message EventsResponse {
    repeated hts.common.Event event = 1;
}

message IsEventAvailableRequest {
    hts.common.Event event = 1;
    google.protobuf.Timestamp date = 2;
}

message GetUpcomingEventsRequest {
    google.protobuf.Timestamp start = 1;
    google.protobuf.Timestamp end = 2;
}

service ParticipantService {
    // Check whether event's start date is before specified date
    rpc IsEventAvailable(IsEventAvailableRequest) returns (google.protobuf.BoolValue);

    // Let user join / cancel events
    rpc JoinEvent(UserWithEventRequest) returns (hts.common.Event);
    rpc CancelEvent(UserWithEventRequest) returns (hts.common.Event);

    // Let user create / remove feedback
    rpc CreateFeedback(CreateFeedbackRequest) returns (hts.common.EventFeedback);
    rpc RemoveFeedback(hts.common.EventFeedback) returns (hts.common.EventFeedback);

    // Return feedback from specific event
    rpc GetFeedbacksFromEvent(hts.common.Event) returns (GetFeedbacksFromEventResponse);
    // Return feedback of user from specific event
    rpc GetUserFeedbackFromEvent(UserWithEventRequest) returns (hts.common.EventFeedback);

    // Return event object from event_id
    rpc GetEvent(GetEventRequest) returns (hts.common.Event);
    // Return all event in database
    rpc GetAllEvents(google.protobuf.Empty) returns (EventsResponse);
    // Return 10 random events --> waiting for machine learning implementation
    rpc GetSuggestedEvents(google.protobuf.Empty) returns (EventsResponse);

    // Get events from search string
    rpc GetEventsByStringOfName(StringInputRequest) returns (EventsResponse);
    // Get events from specified Tag
    rpc GetEventsByTag(hts.common.Tag) returns (EventsResponse);
    // Get event from specified organization
    rpc GetEventsByOrganization(hts.common.Organization) returns (EventsResponse);
    // Get event from specified facility
    rpc GetEventsByFacility(hts.common.Facility) returns (EventsResponse);
    // Get event from specified date
    rpc GetEventsByDate(google.protobuf.Timestamp) returns (EventsResponse);

    // Get events from range of date
    rpc GetUpcomingEvents(GetUpcomingEventsRequest) returns (EventsResponse);

    // Generate QR from combination of ID, User_ID, Event_ID
    rpc GenerateQR(hts.common.UserEvent) returns (GenerateQRResponse);

    // Ping methods to check signal
    rpc Ping(google.protobuf.Empty) returns (google.protobuf.BoolValue);
}
